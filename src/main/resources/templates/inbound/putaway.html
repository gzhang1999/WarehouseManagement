<!DOCTYPE html>
<!--
* CoreUI - Free Bootstrap Admin Template
* @version v2.0.0
* @link https://coreui.io
* Copyright (c) 2018 creativeLabs Łukasz Holeczek
* Licensed under MIT (https://coreui.io/license)
-->

<!--
* gzhang - Warehouse Management System
* @version v0.0.1
* @link
* Copyright (c) 2018 Gary Zhang
* Licensed under MIT (https://github.com/gzhang1999/WarehouseManagement/blob/master/LICENSE)
-->

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragment/header :: common-head">
</head>
<body class="app header-fixed sidebar-fixed aside-menu-fixed sidebar-lg-show">

<div th:replace="fragment/topNav :: headerNav">
</div>
<div class="app-body">


    <div th:replace="fragment/leftNav :: sidebar">
    </div>
    <main class="main">
        <!-- Breadcrumb-->

        <ol th:replace="fragment/breadcrumb :: breadcrumb"></ol>

        <div class="container-fluid">
            <div class="animated fadeIn">
                <div class="card">
                    <div class="card-header">
                    </div>
                    <div class="card-body">
                        <form class="form-inline" id="inventory_query" data-display="inventoryTable" th:action="@{/ws/inbound/putaway/inventory/list}">
                            <div class="form-group my-sm-1">
                                <label for="queryInventoryLPN" class="col-form-label" th:text="#{lpn}">LPN:</label>
                                <input type="text" class="form-control  mx-sm-4" id="queryInventoryLPN" name="lpn" >
                            </div>
                            <div class="form-group my-sm-1">
                                <label for="queryArea" class="col-form-label" th:text="#{area}">Area:</label>
                                <select class="form-control" id="queryArea" name="area_id" data-variable="area"></select>

                            </div>
                            <div class="form-group my-sm-1">
                                <label for="queryLocation" class="col-form-label" th:text="#{location}">Location:</label>
                                <input type="text" class="form-control" id="queryLocation" data-autocomplete=true
                                       data-variable="location" data-filter-variable="queryArea">
                            </div>
                        </form>

                    </div>
                    <div class="card-footer">
                        <button class="btn btn-sm btn-primary" type="button" th:text="#{find}" data-buttontype="query" data-target="inventory_query">
                            <i class="fa fa-dot-circle-o"></i> Find</button>
                        <button class="btn btn-sm btn-primary" type="button" th:text="#{clear}" data-buttontype="clear" data-target="inventory_query">
                            <i class="fa fa-dot-circle-o"></i> Clear</button>
                    </div>
                </div>


                <div class="card card-accent-success">
                    <div class="card-body">
                        <!-- Grid Display -->
                        <div class="row">
                            <div class="col-md-12">
                                <table id = "inventoryTable" class="table table-striped table-bordered display nowrap"
                                       style="width:100%" data-tabletype="datatable" data-init="true" data-scrollx="true">
                                    <thead>
                                        <tr>
                                            <td></td> <!-- checkbox to select certain LPN for putaway -->
                                            <td th:text="#{lpn}">LPN</td>
                                            <td th:text="#{item.name}">Item Name</td>
                                            <td th:text="#{item.description}">Item Description</td>
                                            <td th:text="#{quantity}">Quantity</td>
                                            <td th:text="#{location}">Current Location</td>
                                            <td th:text="#{putaway.policy.suggestedDestination}">Suggested Destination</td>
                                            <td th:text="#{inventory.destination}">Actual Destination</td>
                                        </tr>
                                    </thead>
                                    <tbody th:if="${not #lists.isEmpty(inventoryList)}">
                                        <tr th:each="inventory : ${inventoryList}">
                                            <td>
                                                <input type="checkbox" th:data-type="inventory_checkbox"
                                                       th:data-lpn="${inventory.lpn}"
                                                       th:disabled="${inventory.suggestedDestinationLocation?.name == null && inventory.destinationLocation?.name == null}"
                                                       th:data-suggestdestination="${inventory.suggestedDestinationLocation?.name}"
                                                       th:data-destinationlocation="${inventory.destinationLocation?.name}">
                                            </td>
                                            <td th:text="${inventory.lpn}"></td>
                                            <td th:text="${inventory.itemFootprint.item.name}"></td>
                                            <td th:text="${inventory.itemFootprint.item.description}"></td>
                                            <td th:text="${inventory.quantity}"></td>
                                            <td th:text="${inventory.location?.name}"></td>
                                            <td th:text="${inventory.suggestedDestinationLocation?.name}"></td>
                                            <td th:text="${inventory.destinationLocation?.name}"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">

                        <button type="button" class="btn btn-sm btn-success" id="btnPutawayImmediate"
                                th:text="#{putaway.immediate}"></button>
                        <button type="button" class="btn btn-sm btn-primary" id="btnPutawayWork"
                                th:text="#{putaway.generateWork}"></button>

                    </div>
                </div>
            </div>
        </div>
    </main>


    <aside th:replace="fragment/asidemenu :: aside-menu"></aside>
</div>
<footer th:replace="fragment/footer :: app-footer"></footer>
<script>

    var renderTable = function(tableID, data, customFields) {

        var table = $("#" + tableID).DataTable();

        if (data.length == 0) {
            table.clear().draw();
        }
        else {
            table.clear();
            var htmlData = "";
            $.each(data, function(index, inventory){
                htmlData +=
                    "<tr>" +
                    "   <td> " +
                    "       <input type='checkbox' data-type='inventory_checkbox' " +
                    "              data-lpn='" + inventory.lpn + "'" +
                    "              data-suggestdestination='" + (inventory.suggestedDestinationLocation.name == undefined ? "" : inventory.suggestedDestinationLocation.name) + "'" +
                    "              data-destinationlocation='" + (inventory.destinationLocation.name == undefined ?  "" : inventory.destinationLocation.name) + "'" +
                    "   </td>" +
                    "   <td>" + inventory.lpn + "   </td>" +
                    "   <td>" + inventory.itemFootprint.item.name + "   </td>" +
                    "   <td>" + inventory.itemFootprint.item.description + "   </td>" +
                    "   <td>" + inventory.quantity + "   </td>" +
                    "   <td>" + (inventory.location.name == undefined ?  "" : inventory.location.name) + "   </td>" +
                    "   <td>" + (inventory.suggestedDestinationLocation.name == undefined ?  "" : inventory.suggestedDestinationLocation.name) + "   </td>" +
                    "   <td>" + (inventory.destinationLocation.name == undefined ?  "" : inventory.destinationLocation.name) + "   </td>" +
                     "</tr>";
            });
            var html = $(htmlData.trim().replace(/\s+/g, " ").replace(/\<\/tr\> \<tr/g, '</tr><tr'));
            table.rows.add(html).draw();
        }
    }

    $("#btnPutawayImmediate").click(function(){
        var url="/ws/inbound/putaway/immediate";
        // Loop through all lines and putaway the inventory that selected

        var checkboxList = $("input[data-type='inventory_checkbox']:checkbox:checked");
        console.log("1. checkboxList.length:" + checkboxList.length);
        if(checkboxList.length != 0) {
            checkboxList.each(function(){
                var lpn = $(this).data("lpn")
                var suggestDestination = $(this).data("suggestdestination");
                var destinationLocation = $(this).data("destinationlocation");
                $.ajax({
                    method:"POST",
                    url : url,
                    data:{
                         lpn: lpn,
                         suggestDestination: suggestDestination,
                         destinationLocation: destinationLocation
                    }
                }).done(function(res) {
                     refreshInventoryForm();

                })
            });
        }
    })

    var refreshInventoryForm = function() {
        $("#inventory_query").submit();
    }



    $("#btnPutawayWork").click(function(){
        var url="/ws/inbound/putaway/work";
        // Loop through all lines and putaway the inventory that selected

        var checkboxList = $("input[data-type='inventory_checkbox']:checkbox:checked");
        console.log("2. checkboxList.length:" + checkboxList.length);

        if(checkboxList.length != 0) {
            checkboxList.each(function(){
                var lpn = $(this).data("lpn")
                var suggestDestination = $(this).data("suggestdestination");
                var destinationLocation = $(this).data("destinationlocation");
                $.ajax({
                    method:"POST",
                    url : url,
                    data:{
                         lpn: lpn,
                         suggestDestination: suggestDestination,
                         destinationLocation: destinationLocation
                    }
                }).done(function(res) {
                     refreshInventoryForm();

                })
            });
        }
    })

</script>
</body>
</html>
