<!DOCTYPE html>
<!--
* CoreUI - Free Bootstrap Admin Template
* @version v2.0.0
* @link https://coreui.io
* Copyright (c) 2018 creativeLabs Åukasz Holeczek
* Licensed under MIT (https://coreui.io/license)
-->

<!--
* gzhang - Warehouse Management System
* @version v0.0.1
* @link
* Copyright (c) 2018 Gary Zhang
* Licensed under MIT (https://github.com/gzhang1999/WarehouseManagement/blob/master/LICENSE)
-->

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragment/header :: common-head">
</head>
<body class="app header-fixed sidebar-fixed aside-menu-fixed sidebar-lg-show">

<div th:replace="fragment/topNav :: headerNav">
</div>
<div class="app-body">


    <div th:replace="fragment/leftNav :: sidebar">
    </div>
    <main class="main">
        <!-- Breadcrumb-->

        <ol th:replace="fragment/breadcrumb :: breadcrumb"></ol>

        <div class="container-fluid">
            <div class="animated fadeIn">
                <div class="card">

                    <form method="post" enctype="multipart/form-data"  id="receiptForm">

                        <div class="card-header" >
                            <span th:text="#{receipt.new}"></span>
                            <h5>
                                <a class="badge badge-success float-right" th:href="@{'~' + ${flowExecutionUrl} + '&_eventId_home'}" th:text="#{flow.return.home}" >Return Hom</a>
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Display the trailer and its receipt if we are from 'creating trailer' process -->
                            <div class="card" th:if="${addTrailerFlowModel != null}">
                                <!-- Display the trailer information -->
                                <div class="card-header" id="trailerHeader" role="tab">
                                    <h5 class="mb-0">
                                        <a class="collapsed" data-toggle="collapse" href="#trailerInfo" aria-expanded="false" aria-controls="trailerInfo" th:text="#{trailer.info}">Trailer Info</a>
                                    </h5>
                                </div>
                                <div class="collapse" id="trailerInfo" role="tabpanel" aria-labelledby="trailerHeader">
                                    <div class="card-body">
                                        <ul class="row">
                                            <li class="col-xs-6 col-sm-4 col-md-3">
                                                <span th:text="#{trailer.number}">Trailer Number</span>:
                                                <span th:text="${addTrailerFlowModel.trailer.trailerNumber}"></span>
                                            </li>
                                            <li class="col-xs-6 col-sm-4 col-md-3">
                                                <span th:text="#{trailer.type}">Type</span>:
                                                <span th:text="${addTrailerFlowModel.trailer.trailerType}"></span>
                                            </li>
                                            <li class="col-xs-6 col-sm-4 col-md-3">
                                                <span th:text="#{trailer.driver}">Driver</span>:
                                                <span th:text="${addTrailerFlowModel.trailer.driver}"></span>
                                            </li>
                                            <li class="col-xs-6 col-sm-4 col-md-3">
                                                <span th:text="#{trailer.driver.telephone}">Driver Telephone</span>:
                                                <span th:text="${addTrailerFlowModel.trailer.driverTelephone}"></span>
                                            </li>
                                            <li class="col-xs-6 col-sm-4 col-md-3">
                                                <span th:text="#{trailer.licensePlate}">License Plate</span>:
                                                <span th:text="${addTrailerFlowModel.trailer.licensePlate}"></span>
                                            </li>
                                            <li class="col-xs-6 col-sm-4 col-md-3">
                                                <span th:text="#{carrier}">carrier</span>:
                                                <span th:text="${addTrailerFlowModel.trailer.carrier.description}"></span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Display all the receipts information -->
                            <div class="card" th:if="${addTrailerFlowModel != null}">
                                <div class="card-header" id="receiptsHeader" role="tab">
                                    <h5 class="mb-0">
                                        <a data-toggle="collapse" href="#receiptsInfo" aria-expanded="true" aria-controls="receiptsInfo" th:text="#{trailer.receipts.info}">Receipts Info</a>
                                    </h5>
                                </div>
                                <div class="collapse show" id="receiptsInfo" role="tabpanel" aria-labelledby="receiptsHeader">
                                    <div class="card-body">
                                        <table class="table table-striped table-bordered display nowrap table-selectable" style="width:100%"
                                               data-tabletype="datatable" data-init="true" data-scrollx="true" data-refresh="true"
                                               id="receiptsTable">
                                            <thead>
                                                <tr>
                                                    <td th:text="#{receipt.number}"></td>
                                                    <td th:text="#{receipt.externalID}"></td>
                                                    <td th:text="#{receipt.purchaseOrderNumber}"></td>
                                                    <td th:text="#{receipt.supplier.name}"></td>
                                                    <td th:text="#{receipt.supplier.description}"></td>
                                                    <td></td>
                                                </tr>
                                            </thead>
                                            <tbody th:if="${addTrailerFlowModel.getReceiptList() != null and addTrailerFlowModel.getReceiptList().size() > 0}">
                                                <tr th:each="receipt : ${addTrailerFlowModel.getReceiptList()}" th:if="${not #strings.isEmpty(receipt.number)}">
                                                    <td th:text="${receipt.number}" data-fieldname="receiptNumber"></td>
                                                    <td th:text="${receipt.externalID}" data-fieldname="receiptExternalID"></td>
                                                    <td th:text="${receipt.purchaseOrderNumber}" data-fieldname="purchaseOrderNumber"></td>
                                                    <td th:text="${receipt.supplier.name}" data-fieldname="supplier"></td>
                                                    <td th:text="${receipt.supplier.description}"></td>
                                                    <td>
                                                        <button type="submit" class="btn btn-sm btn-danger btn-remove-row"  name="_eventId_removeReceipt" th:data-receiptnumber="${receipt.number}" th:text="#{remove}">
                                                            <i class="fa fa-dot-circle-o"></i> Remove</button>
                                                    </td>
                                                </tr>
                                            </tbody>

                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <a class="collapsed" th:text="#{receipt.info}">Receipt Info</a>
                                        <button  id="btnClearReceiptInfo" type="button" class="btn btn-sm btn-primary float-right" th:text="#{clear}">
                                            Clear</button>
                                    </h5>
                                </div>
                                <div class="card-body">

                                    <div class="form-inline">
                                        <div class="form-group mx-4">
                                            <label for="receiptNumber" class="col-form-label mx-4" th:text="#{receipt.number}">Receipt Number:</label>
                                            <input type="text" class="form-control" id="receiptNumber" name="number" th:if="${addTrailerFlowModel != null}"
                                                   th:value="${addTrailerFlowModel.currentReceipt != null ? addTrailerFlowModel.currentReceipt.number : ''}">
                                            <input type="text" class="form-control" id="receiptNumber" name="number" th:if="${addReceiptFlowModel != null}"
                                                   th:value="${addReceiptFlowModel.currentReceipt != null ? addReceiptFlowModel.currentReceipt.number : ''}">
                                        </div>
                                        <div class="form-group mx-4">
                                            <label for="receiptExternalID" class="col-form-label mx-4" th:text="#{receipt.externalID}">External ID:</label>
                                            <input type="text" class="form-control" id="receiptExternalID" name="externalID" th:if="${addTrailerFlowModel != null}"
                                                   th:value="${addTrailerFlowModel.currentReceipt != null ? addTrailerFlowModel.currentReceipt.externalID : ''}">
                                            <input type="text" class="form-control" id="receiptExternalID" name="externalID" th:if="${addReceiptFlowModel != null}"
                                                   th:value="${addReceiptFlowModel.currentReceipt != null ? addReceiptFlowModel.currentReceipt.externalID : ''}">
                                        </div>
                                        <div class="form-group mx-4">
                                            <label for="purchaseOrderNumber" class="col-form-label mx-4" th:text="#{receipt.purchaseOrderNumber}">Purchase Order Number:</label>
                                            <input type="text" class="form-control"   id="purchaseOrderNumber" name="purchaseOrderNumber"  th:if="${addTrailerFlowModel != null}"
                                                   th:value="${addTrailerFlowModel.currentReceipt != null ? addTrailerFlowModel.currentReceipt.purchaseOrderNumber : ''}">
                                            <input type="text" class="form-control"   id="purchaseOrderNumber" name="purchaseOrderNumber"  th:if="${addReceiptFlowModel != null}"
                                                   th:value="${addReceiptFlowModel.currentReceipt != null ? addReceiptFlowModel.currentReceipt.purchaseOrderNumber : ''}">
                                        </div>
                                        <div class="form-group mx-4">
                                            <label for="supplier" class="col-form-label mx-4" th:text="#{receipt.supplier}">Supplier:</label>
                                            <input type="text" class="form-control"  id="supplier" name="supplier"  data-controltype="lookup" data-variable="supplier"
                                                   th:if="${addTrailerFlowModel != null}"
                                                   th:value="${(addTrailerFlowModel.currentReceipt != null && addTrailerFlowModel.currentReceipt.supplier != null)  ? addTrailerFlowModel.currentReceipt.supplier.name : ''}">
                                            <input type="text" class="form-control"  id="supplier" name="supplier"  data-controltype="lookup" data-variable="supplier"
                                                   th:if="${addReceiptFlowModel != null}"
                                                   th:value="${(addReceiptFlowModel.currentReceipt != null && addReceiptFlowModel.currentReceipt.supplier != null)  ? addReceiptFlowModel.currentReceipt.supplier.name : ''}">
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button type="submit" class="btn btn-sm btn-primary" name="_eventId_previous" th:text="#{step.previous}">
                                Previous</button>
                            <button type="submit" class="btn btn-sm btn-primary" name="_eventId_moreReceipt" th:text="#{step.flow.trailer.saveAndMoreReceipt}"
                                    th:if="${addTrailerFlowModel != null}">
                                Save and Add More</button>
                            <button type="submit" class="btn btn-sm btn-primary" name="_eventId_saveReceipt" th:text="#{step.flow.trailer.saveAndAddReceiptLine}">
                                Next</button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </main>

    <aside th:replace="fragment/asidemenu :: aside-menu"></aside>
</div>
<footer th:replace="fragment/footer :: app-footer"></footer>
<script>


    $(document).ready(function() {
        // Allow the user to select a row from the Receipt display table and
        // then fill the receipt content into the text box
        var table = $('#receiptsTable').DataTable();

        $('#receiptsTable tbody').on( 'click', 'tr', function () {
            if ( !$(this).hasClass('selected') ) {
                table.$('tr.selected').removeClass('selected');
                $(this).addClass('selected');

                // Fill the selected row into the input box
                $(this).children("td").each(function(){
                    var key = $(this).data("fieldname");
                    var text = $(this).html();
                    console.log("select: " + key + " with value: " + text);
                    if (key != '') {
                        $("#" + key).val(text);
                    }
                });
            }
        });
    })

    $(".btn-remove-row").click(function(event){
        // When remove a receipt, we will call webserver to remove it from current modal
        // and then remove it from display
        var button = $(this);
        $("#receiptNumber").val(button.data("receiptnumber"));
        console.log("set the reciept number value to: " + $("#receiptNumber").val());
    })

    $("#btnClearReceiptInfo").click(function(event){
        $("#receiptNumber").val("");
        $("#receiptExternalID").val("");
        $("#purchaseOrderNumber").val("");
        $("#supplier").val("");
    })

</script>
</body>
</html>
